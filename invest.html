<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="widthgv=device-width, initial-scale=1.0">
  <title>Deposit Funds</title>
  <link rel="stylesheet" href="styles.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
  <style>
  body {
  font-family: Arial, sans-serif;
  margin: 0;
  padding: 0;
  
  background-color: #f4f4f4;
}

header {
  background-color: #f1f1f1;
  color: #fff;
  padding: 10px;
  text-align: center;
  font-size: 12px;
}
header h2 {
  font-size: 12px;
}
h1 {
  margin: 0;
}
        .back-to-home {
            display: flex;
            align-items: center;
            text-decoration: none;
            color: #007;
            font-size: 1.2em;
            font-weight: bold;
            border: 2px solid #f1f1f1;
            padding: 6px 5px;
            border-radius: 5px;
            transition: background-color 0.3s, color 0.3s;
        }
        .back-to-home i {
            margin-right: 10px;
        }
        .back-to-home:hover {
            background-color: #f1f1f1;
            color: #007bff;
        }

main {
  max-width: 800px;
  margin: 20px auto;
  padding: 20px;
}

.deposit-funds-section {
  background-color: #fff;
  border: 1px solid #ccc;
  border-radius: 5px;
  padding: 20px;
}

.deposit-funds-section h2 {
  color: #001041;

}

.form-group {
  margin-bottom: 20px;
}

label {
  display: block;
  margin-bottom: 15px;
}

input[type="text"] {
  width: 100%;
            padding: 20px 30px;
            margin-bottom: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
            background-color: #fff;
      box-shadow: 0px 10px 15px rgba(0, 0, 0, 0.1);
      outline: none;
        }
  
      
select {
  
      display: block;
      width: 100%;
      padding: 20px 50px;
      margin: 0 auto 20px;
      border: 1px solid #ccc;
      border-radius: 5px;
      margin-top: 10px;
      background-color: #fff;
      box-shadow: 0px 10px 15px rgba(0, 0, 0, 0.1);
      outline: none;
      font-weight: 400;
  
        }

button {
  background-color: #007;
  color: #fff;
  border: none;
  font-weight: bold;
  padding: 10px 20px;
  border-radius: 5px;
  cursor: pointer;
}

button:hover {
  background-color: #0056b3;
}

    .bottom-nav {
    position: fixed;
    bottom: 0;
    left: 0;
    width: 100%;
  
    background-color: #fff; /* Light gray background color */
    display: flex;
    justify-content: space-around;
    padding: 5px 0;
    box-shadow: 0px -2px 5px rgba(0, 0, 0, 0.1); /* Shadow effect */
    z-index: 1000; /* Ensure the navigation is on top of other content */
  }

  /* Bottom navigation item style */
  .nav-item {
    text-align: center;
    flex-grow: 1;
    padding: 5px 0;
    color: #007; /* Default color for icons */
    text-decoration: none;
  }

  /* Bottom navigation item icon style */
  .nav-item i {
    font-size: 14px; /* Adjust icon size as needed */
  }

  /* Active item style */
  .active {
    color: #fff; 
    background: #007;
    border-radius: 5px;
    padding: 5px 2px;
    margin: 2px;
    /* Blue color for active item */
  }
  table {
    width: 100%;
    margin: 20px 0;
    border-collapse: collapse;
}

table, th, td {
    border: 1px solid #ddd;
}

th, td {
    padding: 10px;
    text-align: center;
}

th {
    background-color: #f4f4f4;
}
.balado {
  background: #007;
  color: #fff;
  padding: 15px 10px;
}
</style>
</head>
<body>

<header>
          <a href="index.html" class="back-to-home">
            <i class="fas fa-angle-left"></i>Invest
        </a>
 
</header>

<main>
  <section class="deposit-funds-section">
        <div class="user-info">
      
        <p class="balado" id="userBalance">Loading ...</p>
    </div>
        <h2>Select Investment Plan & Amount</h2>
<p>Choose from a variety of investment plans, and the funds will be automatically allocated to your selected plan.</p>                                    
<h2>Investment Summary</h2>
<p>Please ensure all the investment details are correct.</p>
                            
          <form id="investmentForm">
                <div class="form-group"></div>
        <label for="investmentPlan">Select Investment Plan:</label>
        <select id="investmentPlan" required>
            <option value="">Select a plan</option>
            <option value="plan1" data-minimum="100">Plan 1 - $100 minimum</option>
            <option value="plan2" data-minimum="200">Plan 2 - $200 minimum</option>
            <option value="plan3" data-minimum="300">Plan 3 - $300 minimum</option>
            <option value="plan4" data-minimum="400">Plan 4 - $400 minimum</option>
        </select>
</div>
      <div class="form-group">
        <label for="amount">Amount to Investment:</label>
        <input type="text" id="investmentAmount"  placeholder="Enter Amount" name="amount" required>
      </div>
      <br>
        <button type="submit">Invest</button>
      
    </form>
        <div class="investment-summary" id="investmentSummary"></div>
    <div class="investment-history">
        <h2>Investment History</h2>
        <table>
            <thead>
                <tr>
                    <th>Plan</th>
                    <th>Amount</th>
                    <th>Date</th>
                </tr>
            </thead>
            <tbody id="investmentHistory"></tbody>
        </table>
    </div>
    
  </section>
  <br>
  <br>

</main>
  
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-firestore.js"></script>
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyAtVvPjdsj84mWqaG4-7SyjbljCnslZ1SM",
            authDomain: "hendaa-1.firebaseapp.com",
            databaseURL: "https://hendaa-1-default-rtdb.firebaseio.com",
            projectId: "hendaa-1",
            storageBucket: "hendaa-1.appspot.com",
            messagingSenderId: "831134776479",
            appId: "1:831134776479:web:56cd7098fc69cd70a376aa"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // Function to display user info
        function displayUserInfo() {
            firebase.auth().onAuthStateChanged((user) => {
                if (user) {
                    const userRef = db.collection("users").doc(user.uid);
                    userRef.get().then((doc) => {
                        if (doc.exists) {
                            const userData = doc.data();
                            
                            document.getElementById("userBalance").innerText = "Main Balance: $" + (userData.mainBalance || 0);
                        } else {
                            console.log("No such document!");
                        }
                    }).catch((error) => {
                        console.log("Error getting document:", error);
                    });
                } else {
                    window.location.href = "login.html";
                }
            });
        }

        // Function to handle investment submission
        document.getElementById("investmentForm").addEventListener("submit", function(event) {
            event.preventDefault();
            const investmentPlan = document.getElementById("investmentPlan");
            const selectedOption = investmentPlan.options[investmentPlan.selectedIndex];
            const minimumAmount = parseFloat(selectedOption.getAttribute("data-minimum"));
            const investmentAmount = parseFloat(document.getElementById("investmentAmount").value);

            if (investmentAmount < minimumAmount) {
                alert("Can't invest below the minimum amount for the selected plan.");
                return;
            }

            firebase.auth().onAuthStateChanged((user) => {
                if (user) {
                    const userRef = db.collection("users").doc(user.uid);
                    userRef.get().then((doc) => {
                        if (doc.exists) {
                            const userData = doc.data();
                            const mainBalance = userData.mainBalance || 0;
                            if (mainBalance < investmentAmount) {
                                alert("Insufficient balance for this investment.");
                                return;
                            }

                            const newMainBalance = mainBalance - investmentAmount;
                            const withdrawalBalance = userData.withdrawalBalance || 0;
                            const newWithdrawalBalance = withdrawalBalance + investmentAmount;

                            // Update balances in Firestore
                            userRef.update({
                                mainBalance: newMainBalance,
                                withdrawalBalance: newWithdrawalBalance
                            }).then(() => {
                                alert("Investment successful!");
                                // Add investment to history
                                db.collection("users").doc(user.uid).collection("investments").add({
                                    plan: selectedOption.text,
                                    amount: investmentAmount,
                                    timestamp: firebase.firestore.FieldValue.serverTimestamp()
                                });

                                // Display investment summary
                                document.getElementById("investmentSummary").innerHTML = `
                                    <h2>Investment Summary</h2>
                                    <p>Plan: ${selectedOption.text}</p>
                                    <p>Amount: $${investmentAmount}</p>
                                    <p>Main Balance: $${newMainBalance}</p>
                                    <p>Withdrawal Balance: $${newWithdrawalBalance}</p>
                                `;

                                // Display updated investment history
                                displayInvestmentHistory(user.uid);

                                // Update the displayed user balance
                                document.getElementById("userBalance").innerText = "Main Balance: $" + newMainBalance;
                            }).catch((error) => {
                                console.error("Error updating balances: ", error);
                            });
                        }
                    }).catch((error) => {
                        console.log("Error getting document:", error);
                    });
                } else {
                    window.location.href = "login.html";
                }
            });
        });

        // Function to display investment history
        function displayInvestmentHistory(userId) {
            db.collection("users").doc(userId).collection("investments").orderBy("timestamp", "desc").get().then((querySnapshot) => {
                const investmentHistory = document.getElementById("investmentHistory");
                investmentHistory.innerHTML = ""; // Clear previous data

                querySnapshot.forEach((doc) => {
                    const investment = doc.data();
                    const row = document.createElement("tr");
                    row.innerHTML = `
                        <td>${investment.plan}</td>
                        <td>$${investment.amount}</td>
                        <td>${new Date(investment.timestamp.toDate()).toLocaleString()}</td>
                    `;
                    investmentHistory.appendChild(row);
                });
            }).catch((error) => {
                console.log("Error getting investment history: ", error);
            });
        }

        // Display user info and investment history on page load
        firebase.auth().onAuthStateChanged((user) => {
            if (user) {
                displayUserInfo();
                displayInvestmentHistory(user.uid);
            }
        });
    </script>
</body>
</html>